
include:
  - template: Auto-DevOps.gitlab-ci.yml

stages:
  - build
  - test
  - deploy  # dummy stage to follow the template guidelines
  - review
  - dast
  - staging
  - canary
  - production
  - incremental rollout 10%
  - incremental rollout 25%
  - incremental rollout 50%
  - incremental rollout 100%
  - performance
  - cleanup


test:  # The herokuish buildpacks doesnt support Python Testing
  stage: test-ci
  image: python:3.8
  script:
    - echo "Running custom tests"
    - pip install -r requirements.txt
    - pytest  tests/test-app.py
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      when: always
